System.register(["jimu-core","jimu-ui","jimu-theme","jimu-layouts/layout-runtime","jimu-for-builder","jimu-core/dnd","jimu-ui/advanced/setting-components","jimu-layouts/layout-builder"],(function(e,t){var o={},i={},n={},l={},a={},r={},s={},d={};return{setters:[function(e){o.APP_FRAME_NAME_IN_BUILDER=e.APP_FRAME_NAME_IN_BUILDER,o.AppMode=e.AppMode,o.BrowserSizeMode=e.BrowserSizeMode,o.ContainerType=e.ContainerType,o.ControllerPosition=e.ControllerPosition,o.ErrorBoundary=e.ErrorBoundary,o.ExtensionManager=e.ExtensionManager,o.Immutable=e.Immutable,o.LayoutItemType=e.LayoutItemType,o.LayoutParentType=e.LayoutParentType,o.LayoutType=e.LayoutType,o.PagePart=e.PagePart,o.React=e.React,o.ReactRedux=e.ReactRedux,o.WidgetManager=e.WidgetManager,o.WidgetState=e.WidgetState,o.WidgetType=e.WidgetType,o.appActions=e.appActions,o.appConfigUtils=e.appConfigUtils,o.classNames=e.classNames,o.createSelector=e.createSelector,o.css=e.css,o.extensionSpec=e.extensionSpec,o.getAppStore=e.getAppStore,o.getIndexFromProgress=e.getIndexFromProgress,o.hooks=e.hooks,o.i18n=e.i18n,o.jimuHistory=e.jimuHistory,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished,o.utils=e.utils},function(e){i.Button=e.Button,i.Dropdown=e.Dropdown,i.DropdownButton=e.DropdownButton,i.DropdownMenu=e.DropdownMenu,i.Icon=e.Icon,i.Loading=e.Loading,i.NavButtonGroup=e.NavButtonGroup,i.Popper=e.Popper,i.Tooltip=e.Tooltip,i._Popper=e._Popper,i.defaultMessages=e.defaultMessages,i.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier,i.utils=e.utils},function(e){n.Theme2GlobalStyleClassName=e.Theme2GlobalStyleClassName,n.getBuilderThemeVariables=e.getBuilderThemeVariables,n.getTheme=e.getTheme,n.getTheme2=e.getTheme2,n.styled=e.styled,n.withBuilderTheme=e.withBuilderTheme},function(e){l.LayoutContext=e.LayoutContext,l.PageContext=e.PageContext,l.searchUtils=e.searchUtils,l.utils=e.utils},function(e){a.appBuilderSync=e.appBuilderSync,a.builderAppSync=e.builderAppSync,a.getAppConfigAction=e.getAppConfigAction},function(){},function(e){s.WidgetListPopper=e.WidgetListPopper},function(e){d.CanvasPane=e.CanvasPane,d.DropArea=e.DropArea,d.addItemToLayout=e.addItemToLayout,d.withRnd=e.withRnd}],execute:function(){e((()=>{var e={95369:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},41553:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},25164:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M4 4h2v1H4zM8 4h2v1H8zM14 4h-2v1h2zM15 4h1v2h-1zM16 8h-1v2h1zM4 14h1v2H4zM5 6H4v2h1zM4 10h1v2H4zM16 12h-1v2h1zM16 15v1h-2v-1zM12 15h-2v1h2zM6 15h2v1H6z"></path><path fill="#000" fill-rule="evenodd" d="M18 0a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path></svg>'},11407:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.538.538 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.538.538 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},3273:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.538.538 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.538.538 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},55339:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},39365:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14.994 2.243A1.375 1.375 0 0 0 13.625 1h-7.25l-.132.006A1.375 1.375 0 0 0 5 2.375v1.75h.917v-1.75l.007-.082a.458.458 0 0 1 .451-.376h7.25l.082.007a.458.458 0 0 1 .376.451v7.25l-.007.082a.458.458 0 0 1-.451.376h-1.738V11h1.738l.132-.006A1.375 1.375 0 0 0 15 9.625v-7.25zM9.625 5h-7.25C1.615 5 1 5.616 1 6.375v7.25C1 14.385 1.616 15 2.375 15h7.25c.76 0 1.375-.616 1.375-1.375v-7.25C11 5.615 10.384 5 9.625 5M2.4 6h7.2c.22 0 .4.201.4.45v7.1c0 .248-.18.45-.4.45H2.4c-.22 0-.4-.201-.4-.45v-7.1c0-.249.18-.45.4-.45M4 8h4v1H4zm4 3H4v1h4z" clip-rule="evenodd"></path></svg>'},50970:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.5 11a.5.5 0 0 0 .5-.5V2h8.5a.5.5 0 0 0 0-1H2a1 1 0 0 0-1 1v8.5a.5.5 0 0 0 .5.5M5 4h9a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1m0 1v9h9V5z" clip-rule="evenodd"></path></svg>'},83616:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 0a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm0 1H4a3 3 0 0 0-2.995 2.824L1 4v8a3 3 0 0 0 2.824 2.995L4 15h8a3 3 0 0 0 2.995-2.824L15 12V4a3 3 0 0 0-2.824-2.995zM8 4a4 4 0 1 1 0 8 4 4 0 0 1 0-8m0 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6" clip-rule="evenodd"></path></svg>'},35384:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 1.914 6.475 2.94a.5.5 0 1 1-.707-.707L8 0l2.157 2.157a.5.5 0 0 1-.707.707l-.95-.95V7.5h5.586l-1.1-1.1a.5.5 0 1 1 .706-.708L16 8l-2.232 2.232a.5.5 0 1 1-.707-.707L14.086 8.5H8.5v5.586l1.025-1.025a.5.5 0 1 1 .707.707L8 16l-2.308-2.308a.5.5 0 1 1 .707-.707l1.101 1.1V8.5H1.914l.95.95a.5.5 0 0 1-.707.707L0 8l2.232-2.232a.5.5 0 1 1 .707.707L1.914 7.5H7.5z" clip-rule="evenodd"></path></svg>'},63059:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 8.002a.5.5 0 0 1-1 0V1H1v12.003h3.5a.5.5 0 1 1 0 1H1a1 1 0 0 1-1-1V1A1 1 0 0 1 .044.706.498.498 0 0 1 .5 0H11a1 1 0 0 1 1 1zm2.218 1.486a.5.5 0 0 0-.708 0l-5.657 5.658a.5.5 0 0 0 .708.707l5.657-5.658a.5.5 0 0 0 0-.707M11 9.928c.376 0 .794.041 1.23.141l-.871.871a5.147 5.147 0 0 0-.359-.012c-1 0-2.731.297-3.83 2 .313.486.677.857 1.062 1.14l-.676.676A6.081 6.081 0 0 1 6 12.928c1.333-2.334 3.5-3 5-3m0 5c-.219 0-.472-.014-.746-.054l-.824.825a5.62 5.62 0 0 0 1.57.23c1.5 0 3.667-.667 5-3a6.012 6.012 0 0 0-1.804-1.998l-.684.684c.478.299.936.721 1.319 1.313-1.1 1.704-2.831 2-3.831 2M2.5 3.502A.5.5 0 0 1 3 3h6a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},34750:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},54357:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},47465:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 0a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm0 1H4a3 3 0 0 0-2.995 2.824L1 4v8a3 3 0 0 0 2.824 2.995L4 15h8a3 3 0 0 0 2.995-2.824L15 12V4a3 3 0 0 0-2.824-2.995zM8 4a4 4 0 1 0 0 8 4 4 0 0 0 0-8" clip-rule="evenodd"></path></svg>'},48891:e=>{"use strict";e.exports=o},54020:e=>{"use strict";e.exports=r},23137:e=>{"use strict";e.exports=a},77282:e=>{"use strict";e.exports=d},74758:e=>{"use strict";e.exports=l},34796:e=>{"use strict";e.exports=n},30726:e=>{"use strict";e.exports=i},77756:e=>{"use strict";e.exports=s}},t={};function u(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,u),n.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var o in t)u.o(t,o)&&!u.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{"use strict";u.r(c),u.d(c,{default:()=>Qe});var e=u(48891),t=u(30726);const o="controller",i={sm:24,default:32,lg:48},n=(e.ControllerPosition.TopRight,[{name:"preventOverflow",options:{boundary:document.body,rootBoundary:document}},{name:"offset",options:{offset:[0,16]}}]);var l=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o};const a=(e,t,o)=>{let n=i[e];return t&&(n+=21),n+=2*r(e,o),n},r=(e,t)=>"circle"===t?"sm"===e?4:"default"===e?2:"lg"===e?0:void 0:6,s=e.React.forwardRef(((o,i)=>{var n;const{label:s,className:d,title:u,showLabel:c,showIndicator:p=!0,showTooltip:g=!0,labelGrowth:v=0,icon:h,marker:f,onClick:m,onMarkerClick:y,avatar:w,autoFlip:b,active:I,editDraggable:x,disabled:C,widgetid:S}=o,R=l(o,["label","className","title","showLabel","showIndicator","showTooltip","labelGrowth","icon","marker","onClick","onMarkerClick","avatar","autoFlip","active","editDraggable","disabled","widgetid"]),k=w||{},{shape:P,style:A}=k,j=l(k,["shape","style"]),M=((t,o,i,n,l)=>e.React.useMemo((()=>{const s=a(t,o,n),d=s+l,u=r(t,n);return e.css`
      display: flex;
      align-items:center;
      flex-direction: column;
      justify-content: ${o?"space-around":"center"};
      width: ${e.polished.rem(d)} !important;
      height: ${e.polished.rem(s)};
      .tool-drag-handler {
        cursor: auto;
      }
      .avatar {
        padding: ${u}px;
        position: relative;
        text-align: center;
        &:hover .marker {
          visibility: visible;
        }
        .marker {
          position: absolute;
          right: 0;
          top: 0;
          padding: 0;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          .icon-btn-sizer {
            min-width: .625rem;
            min-height: .625rem;
          }
          visibility: hidden;
        }
      }
      ${i?".avatar.active {\n        .avatar-button, .marker {\n          transform: translateY(-7px);\n        }\n        .marker {\n          z-index: 1;\n        }\n        ::after {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 50%;\n          transform: translateX(-50%);\n          border: 1px solid var(--white);\n          border-radius: 3px;\n          width: 6px;\n          height: 3px;\n          background-color: var(--primary);\n          box-sizing: content-box;\n        }\n      }":""}
      .avatar-label {
        text-align: center;
        width: 100%;
        min-height: ${e.polished.rem(21)};
        cursor: default;
      }
    `}),[t,o,n,l,i]))(null==j?void 0:j.size,c,p,P,v),L=(0,e.jsx)(t.Button,Object.assign({"data-widgetid":S,icon:!0,active:I,className:(0,e.classNames)("avatar-button",{disabled:C}),ref:i},j,{style:Object.assign({borderRadius:"circle"===P?"50%":void 0},A),onClick:m}),(0,e.jsx)(t.Icon,{color:"string"!=typeof h&&(null===(n=h.properties)||void 0===n?void 0:n.color),icon:"string"!=typeof h?h.svg:h,autoFlip:b}));return(0,e.jsx)("div",Object.assign({},R,{className:(0,e.classNames)("avatar-card",`${d} avatar-card`),css:M}),(0,e.jsx)("div",{className:(0,e.classNames)({"no-drag-action":!x,active:I},"avatar tool-drag-handler")},f&&(0,e.jsx)(t.Button,{className:"marker",size:"sm",icon:!0,onClick:y},(0,e.jsx)(t.Icon,{size:8,icon:f})),g?(0,e.jsx)(t.Tooltip,{title:u||s,style:{pointerEvents:"none"}},L):L),c&&(0,e.jsx)("div",{className:(0,e.classNames)("avatar-label text-truncate",{active:I})},s))}));var d=u(55339),p=u.n(d);const g=(e,t,o)=>{let i=e,n=t;return n-i>o?n=e+o:n-i<o&&(i=0,n=i+o),[i,n]};const v=[],h=e.React.forwardRef(((o,i)=>{const{scrollRef:n,className:l,lists:a=v,createItem:r,vertical:s,itemLength:d,space:u,onChange:c,autoHideArrow:p,minLength:h=d,autoScrollEnd:f,autoSize:m,onScrollStatusChange:y}=o,w=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o}(o,["scrollRef","className","lists","createItem","vertical","itemLength","space","onChange","autoHideArrow","minLength","autoScrollEnd","autoSize","onScrollStatusChange"]),b=e.hooks.useTranslation(t.defaultMessages),[I,x]=e.hooks.useForwardRef(i),{start:C,end:S,disablePrevious:R,disableNext:k,hideArrow:P,scroll:A}=(t=>{var o;const{rootRef:i,lists:n,itemLength:l,autoSize:a,vertical:r,space:s,minLength:d,autoScrollEnd:u}=t,c=null!==(o=null==n?void 0:n.length)&&void 0!==o?o:0,p=((t,o,i=0,n=i,l)=>{let a=((t,o=500,i=!1,n)=>{var l,a;const r=i?"clientHeight":"clientWidth",[s,d]=e.React.useState(null!==(a=null===(l=t.current)||void 0===l?void 0:l[r])&&void 0!==a?a:0),u=!n&&!window.jimuConfig.isInBuilder,c=e.hooks.useLatest((()=>{const e=t.current[r]||0;d(e)})),p=e.React.useMemo((()=>e.lodash.debounce((()=>{c.current()}),o,{leading:!0})),[]);return e.React.useEffect((()=>{if(u)return;const e=t.current;e&&p();const o=new ResizeObserver(p);return o.observe(e),()=>{o.disconnect(),p.cancel()}}),[t,p,u]),s})(t,500,o,!l);a+=i,a=Math.max(a,n);const r=((t=500,o=!1)=>{const i=o?"clientHeight":"clientWidth",[n,l]=e.React.useState((()=>document.body[i]-40));e.hooks.useUpdateEffect((()=>{l(document.body[i]-40)}),[i]);const a=e.React.useMemo((()=>e.lodash.debounce((()=>{l(document.body[i]-40)}),t)),[i,t]);return e.React.useEffect((()=>(window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)})),[a]),n})(500,o);return a=l?r:Math.min(a,r),a})(i,r,s,d,a),v=Math.floor(p/l),[h,f]=e.React.useState(g(0,0,v)[0]),[m,y]=e.React.useState(g(0,0,v)[1]),w=e.hooks.useLatest(h),b=e.hooks.useLatest(m),I=m-h>=c,x=0===h,C=m===c;e.React.useEffect((()=>{if(0===p)return;const[e,t]=g(b.current,w.current,v);f(e),y(t)}),[v,p,b,w]);const S=e.hooks.useEventCallback(((e,t=!0)=>{const o=t?1:v;let i=0,n=0;e?(i=h-o,i<0?(i=0,n=i+v):n=m-o):(n=m+o,n>c?(n=c,i=n-v):i=h+o),f(i),y(n)})),R=e.React.useRef([]),k=e.hooks.useEventCallback((()=>{const e=c>0&&R.current.length>0&&n[n.length-1]!==R.current[R.current.length-1];if(u&&e&&R.current.length>c){let e=0,t=0;t=c,e=t-v,e=Math.max(0,e),f(e),y(t)}}));return e.React.useEffect((()=>{k(),R.current=n}),[n,k]),{start:h,end:m,disablePrevious:x,disableNext:C,hideArrow:I,scroll:S}})({rootRef:I,lists:a,itemLength:d,autoSize:m,vertical:s,space:u,minLength:h,autoScrollEnd:f}),j=a.slice(C,S),M=((t,o,i,n,l)=>e.css`
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    button.previous, button.next {
      flex-shrink: 0;
      display: ${l?"none":"block"};
    }
    .root {
      flex-direction: ${t?"column":"row"};
      width: 100%;
      height: 100%;
      min-width: ${e.polished.rem(i)};
      max-height: ${n?"100%":"calc(100% - 20px)"};
      max-width: ${n?"100%":"calc(100% - 20px)"};
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      align-items: center;
      .scroll-list-item {
        &:not(:first-of-type) {
          margin-top: ${t?e.polished.rem(o):"unset"};
          margin-left: ${t?"unset":e.polished.rem(o)};
        }
      }
    }
`)(s,u,h,m,P);return e.React.useEffect((()=>{null==y||y(P,R,k)}),[k,R,P,y]),e.React.useEffect((()=>{t.utils.setRef(n,A)}),[A,n]),(0,e.jsx)(t.NavButtonGroup,Object.assign({},w,{css:M,type:"tertiary",vertical:s,onChange:e=>{null==c||c(e),A(e,!0)},disablePrevious:R,disableNext:k,previousAriaLabel:b("previous"),nextAriaLabel:b("next"),className:(0,e.classNames)("scroll-list",l)}),(0,e.jsx)("div",{className:"root scroll-list-root",ref:x},a.map((t=>{const o=!j.includes(t);return r(t,(0,e.classNames)("scroll-list-item",{"d-none":o}))}))))}));var f=u(25164),m=u.n(f),y=u(34796);const w=(0,y.styled)("div",{shouldForwardProp:e=>!["vertical","space"].includes(e)})`
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: ${e=>e.vertical?"column":"row"};
  .avatar-placeholder {
    &:not(:first-of-type) {
      margin-top: ${t=>t.vertical?e.polished.rem(t.space):"unset"};
      margin-left: ${t=>t.vertical?"unset":e.polished.rem(t.space)};
    }
  }
`,b=(e=>{const t=[];for(;e>0;)t.push(e),e--;return t})(3),I={type:"secondary",size:"lg",shape:"circle"},x=t=>{const{vertical:o,space:i,size:n="lg"}=t,l=e.React.useMemo((()=>Object.assign(Object.assign({},I),{size:n})),[n]);return e.React.createElement(w,{className:"list-placeholder",vertical:o,space:i},b.map(((t,o)=>e.React.createElement(s,{key:o,disabled:!0,className:"avatar-placeholder",icon:m(),label:"",showTooltip:!1,avatar:l}))))};function C(o){const{widgetId:i,canCrossLayoutBoundary:n,showMask:l,className:a,layoutId:r,layoutItemId:s}=o,d=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o}(o,["widgetId","canCrossLayoutBoundary","showMask","className","layoutId","layoutItemId"]),u=e.hooks.useCancelablePromiseMaker(),[c,p]=e.React.useState(null),[g,v]=e.React.useState(""),[h,f]=e.React.useState("");e.React.useEffect((()=>{p(null),v("");const t=u((t=>{var o,i;if(t)return(null===(i=null===(o=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===o?void 0:o[t])||void 0===i?void 0:i.isClassLoaded)?Promise.resolve(e.WidgetManager.getInstance().getWidgetClass(t)):e.WidgetManager.getInstance().loadWidgetClass(t)})(i));t.then((e=>{p(e),v(i)}),(e=>{var t;f(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:e)}))}),[u,i]);const m=e.React.useCallback((()=>{var t,o;h||window.jimuConfig.isBuilder||(null===(o=null===(t=(0,e.getAppStore)().getState().widgetsRuntimeInfo)||void 0===t?void 0:t[i])||void 0===o?void 0:o.state)===e.WidgetState.Active||(0,e.getAppStore)().dispatch(e.appActions.activateWidget(i))}),[h,i]),y=(0,e.classNames)("widget-renderer w-100 h-100",a),w=(t=>e.React.useMemo((()=>e.css`
      overflow: ${t?"visible":"hidden"};
      position: relative;
      .widget-content {
        position: relative;
        height: 100%;
        width: 100%;
        z-index: 0;
      }
      .widget-mask {
        position: absolute;
        background: transparent;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 1;
      }
  `),[t]))(n);return(0,e.jsx)("div",Object.assign({css:w,className:y,onMouseDownCapture:m,"data-widgetid":g},d),(0,e.jsx)("div",{className:"widget-content p-1"},h,!h&&c&&(0,e.jsx)(e.ErrorBoundary,null,(0,e.jsx)(c,{widgetId:g,layoutId:r,layoutItemId:s})),!h&&!c&&(0,e.jsx)(t.Loading,null)),l&&(0,e.jsx)("div",{className:"widget-mask"}))}var S=u(95369),R=u.n(S);const k=e.React.createContext({});var P=u(74758);const A=(0,y.withBuilderTheme)(t.Tooltip),j=window.jimuConfig.isInBuilder?A:t.Tooltip,M=[{name:"flip",options:{fallbackPlacements:["top","right"]}}];class L extends e.React.PureComponent{constructor(e){super(e),P.utils.autoBindHandlers(this,["select","handleMouseEnter","handleMouseLeave"])}componentDidUpdate(){const e=this.getValue(this.props.visible,this.contextProps),t=this.getValue(this.props.disabled,this.contextProps);e&&!t||this.contextProps.onItemUnSelected(this.props.uid)}componentWillUnmount(){this.contextProps.onItemUnSelected(this.props.uid)}select(e){if(e.stopPropagation(),this.props.onClick){const{parentRef:t}=this.contextProps;this.props.onClick({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:t&&t.getBoundingClientRect()},e),this.contextProps.onItemClick(this.props.uid)}}handleDoubleClick(e){e.stopPropagation()}handleMouseEnter(e){e.stopPropagation(),this.props.onMouseEnter&&this.props.onMouseEnter({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:null},e)}handleMouseLeave(e){e.stopPropagation(),this.props.onMouseLeave&&this.props.onMouseLeave({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:null},e)}getValue(e,t){return"function"==typeof e?e(t):e}getStyle(){const{theme:t}=this.contextProps;return e.css`
      cursor: pointer;
      width: 32px;
      min-height: 32px;
      display: flex;
      justify-content: flex-start;
      user-select: none;
      background: ${t.colors.palette.light[300]};

      &:hover {
        background: ${t.colors.palette.light[500]};
      }
      &.selected {
        background: ${t.colors.primary};
      }

      &.disabled,
      &.no-action {
        cursor: default;
        &:hover {
          background: ${t.colors.palette.light[300]};
        }
      }
      &.disabled {
        .jimu-btn {
          cursor: default;
        }
        .jimu-btn svg, .toolbar-label {
          color: ${t.colors.palette.dark[200]} !important;
        }
      }

      &.msg {
        width: auto;
        font-size: 12px;
        color: ${t.colors.black};
        letter-spacing: 0.33px;
        text-align: center;
        padding: 0 8px;
      }

      .toolbar-group & {
        justify-content: flex-start;
      }

      .popper {
        border: 1px solid ${t.colors.palette.dark[400]};
      }

      .toolbar-label {
        color: ${t.colors.black};
      }
    `}separatorStyle(){const{theme:t}=this.contextProps;return this.props.isInGroup?e.css`
        width: 100%;
        height: 1px;
        background-color: ${t.colors.palette.light[600]};
        align-self: center;
      `:e.css`
      div.toolbar-item + &,
      div.toolbar-group + & {
        display: block;
      }
      display: none;
      width: 1px;
      height: 30px;
      border-left: 1px solid ${t.colors.palette.light[600]};
      align-self: center;
    `}tooltipStyle(){const{theme:t}=this.contextProps;return e.css`
      border: none;

      .tooltip {
        color: ${t.colors.black};
        background-color: ${t.colors.palette.light[600]};
        border-color: ${t.colors.palette.light[300]};
      }
    `}createButton({textContent:o,iconContent:i,tooltip:n,isDisabled:l,noAction:a,isChecked:r,rotate:s,iconSize:d,autoFlipIcon:u,ref:c}){const p=o?"":n,g=l?{title:p}:{},v=(0,e.jsx)(t.Button,Object.assign({"aria-label":o||n,ref:c,className:"px-0 w-100 text-left",type:"tertiary",size:"sm",icon:i&&!o,role:"menuitem",onClick:l||a?null:this.select,disabled:l,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onDoubleClick:this.handleDoubleClick,"data-extname":this.props.extName},g),i&&(0,e.jsx)(t.Icon,{className:(0,e.classNames)("tool-item-icon",{checked:r}),icon:i,rotate:s,size:d,color:this.contextProps.theme.colors.black,autoFlip:u}),o&&(0,e.jsx)("span",{className:"toolbar-label text-nowrap"},o));return l?v:(0,e.jsx)(j,{placement:"bottom",title:p,modifiers:M,css:this.tooltipStyle()},v)}render(){const{icon:o,autoFlipIcon:i,label:n,size:l,checked:a,disabled:r,visible:s,rotate:d,settingPanel:u,title:c,uid:p,widgetId:g,className:v,seperator:h}=this.props;if(h)return(0,e.jsx)(k.Consumer,null,(t=>(this.contextProps=t,(0,e.jsx)("div",{"data-testid":"toolbarSeparator",css:this.separatorStyle()}))));const f=null==this.props.onClick,m=l||16,y=u;return(0,e.jsx)(k.Consumer,null,(l=>{if(this.contextProps=l,g&&l.layoutItem.widgetId!==g)return null;let h="";"function"==typeof c?h=c(l):"string"==typeof c&&(h=c);const w=u&&l.activeItem===p&&l.toggleOn,b=w||this.getValue(a,l),I=this.getValue(r,l),x=this.getValue(s,l),C=this.getValue(n,l),S=this.getValue(o,l);return null==s||x?(0,e.jsx)("div",{className:(0,e.classNames)("toolbar-item",v,{selected:b,disabled:I,msg:C,"no-action":f}),css:this.getStyle()},!y&&this.createButton({textContent:C,iconContent:S,tooltip:h,isDisabled:I,noAction:f,isChecked:b,rotate:d,iconSize:m,autoFlipIcon:i,ref:null}),y&&(0,e.jsx)(e.React.Fragment,null,this.createButton({textContent:C,iconContent:S,tooltip:h,isDisabled:I,noAction:f,isChecked:b,rotate:d,iconSize:m,autoFlipIcon:i,ref:e=>{this.reference=e}}),(0,e.jsx)(t.Popper,{placement:"bottom-start",reference:this.reference,open:w,disablePortal:!0},(0,e.jsx)("div",{css:e.css`
                          display: flex;
                          pointer-events: all;
                          background-color: ${l.theme.colors.white};
                          border-radius: 2px;
                          box-shadow: 0 2px 8px 1px rgba(0, 0, 0, 0.2);
                        `,className:"d-flex"},w&&(0,e.jsx)(y,Object.assign({},l)))))):null}))}}const z=()=>{},T=window.jimuConfig.isInBuilder?A:t.Tooltip;class B extends e.React.PureComponent{constructor(t){super(t),this.dropdownBtnRef=e.React.createRef(),P.utils.autoBindHandlers(this,["togglePopToolItems","onItemClick"])}getBaseStyle(){const{theme:t}=this.contextProps;return e.css`
      cursor: pointer;
      display: flex;
      justify-content: space-around;
      align-items: center;
      background-color: ${t.colors.palette.light[300]};

      &:hover {
        background-color: ${t.colors.palette.light[500]} !important;
      }
    `}getValue(e,t){return"function"==typeof e?e(t):e}togglePopToolItems(e){e&&e.stopPropagation(),this.contextProps.onItemClick(this.props.uid)}onItemClick(t,o){const{parentRef:i}=this.contextProps;t.onClick(Object.assign(Object.assign({},o),{clientRect:i.getBoundingClientRect()})),e.lodash.defer((()=>{this.dropdownBtnRef.current.focus()}))}createToolItem(t,o,i){return t.onClick||t.seperator?(0,e.jsx)(L,Object.assign({key:i,uid:`${this.props.uid}_${i+1}`,isInGroup:!0},t,{onClick:()=>{this.onItemClick(t,o)}})):null}getGroupMenu(o,i){const{theme:n}=this.contextProps;return o?(0,e.jsx)(t.Icon,{rotate:o.rotate,icon:o.icon,size:o.size||16,color:n.colors.black}):i[0].icon?(0,e.jsx)(t.Icon,{icon:i[0].icon,size:i[0].size||16,color:n.colors.black}):(0,e.jsx)(L,Object.assign({uid:`${this.props.uid}_0`,onClick:z},i[0]))}handleDoubleClick(e){e.stopPropagation()}tooltipStyle(){const{theme:t}=this.contextProps;return e.css`
      border: none;

      .tooltip {
        color: ${t.colors.black};
        background-color: ${t.colors.palette.light[600]};
        border-color: ${t.colors.palette.light[300]};
      }
    `}render(){const{tools:o,uid:i}=this.props;return o&&0!==o.length?(0,e.jsx)(k.Consumer,null,(n=>{this.contextProps=n;const{visible:l,caret:a=!0,title:r}=o[0],s=this.getValue(l,n);if(void 0!==l&&!s)return null;const d=o.filter((e=>{const{visible:t}=e,o=this.getValue(t,n);return void 0===t||o}));if(0===d.length)return null;if(1===d.length)return(0,e.jsx)(L,Object.assign({uid:`${i}_0`},d[0]));let u;d.some((e=>{const{checked:t}=e;if(this.getValue(t,n))return u=e,!0}));let c="";return"function"==typeof r?c=r(n):"string"==typeof r&&(c=r),(0,e.jsx)("div",{className:"toolbar-group",css:this.getBaseStyle()},(0,e.jsx)(t.Dropdown,{direction:"down",size:"sm",className:a?"px-1":"",isOpen:n.toggleOn&&n.activeItem===i,toggle:this.togglePopToolItems},(0,e.jsx)(T,{placement:"bottom",title:c,css:this.tooltipStyle()},(0,e.jsx)(t.DropdownButton,{icon:!0,arrow:a,type:"tertiary",size:"sm",ref:this.dropdownBtnRef,css:e.css`
                      .caret-icon {
                        color: ${n.theme.colors.palette.dark[600]};
                        margin-left: 0.25rem;
                      }
                    `,onDoubleClick:this.handleDoubleClick},this.getGroupMenu(u,d))),(0,e.jsx)(t.DropdownMenu,{className:`p-0 ${window.jimuConfig.isInBuilder?y.Theme2GlobalStyleClassName:""}`,css:e.css`min-width: 5rem;`},d.map(((e,t)=>this.createToolItem(e,n,t))))))})):null}}var O,N,E,$,D=u(23137);function H(t,o,i){var n,l,a,r,s,d,u,c,p,g;const{layoutId:v}=t,h=o.layouts[v];switch(null===(n=null==h?void 0:h.parent)||void 0===n?void 0:n.type){case e.LayoutParentType.View:{const e=o.views[h.parent.id],t=o.sections[e.parent];return 1===(null===(a=null===(l=null==t?void 0:t.parent)||void 0===l?void 0:l[i])||void 0===a?void 0:a.length)?t.parent[i][0]:(null===(s=null===(r=null==t?void 0:t.parent)||void 0===r?void 0:r[i])||void 0===s?void 0:s.length)>1?H(t.parent[i][0],o,i):null}case e.LayoutParentType.Widget:{const e=o.widgets[h.parent.id];return 1===(null===(u=null===(d=null==e?void 0:e.parent)||void 0===d?void 0:d[i])||void 0===u?void 0:u.length)?e.parent[i][0]:(null===(p=null===(c=null==e?void 0:e.parent)||void 0===c?void 0:c[i])||void 0===p?void 0:p.length)>1?H(e.parent[i][0],o,i):null}case e.LayoutParentType.Screen:{const e=o.screens[h.parent.id];return null===(g=o.screenGroups[e.parent].parent)||void 0===g?void 0:g[i]}default:return null}}!function(e){e[e.BringForward=0]="BringForward",e[e.SendBackward=1]="SendBackward",e[e.BringToFront=2]="BringToFront",e[e.SendToBack=3]="SendToBack"}(O||(O={})),function(e){e.Auto="auto",e[e.Normal=0]="Normal",e[e.BoundaryDropArea=10]="BoundaryDropArea",e[e.DragMoveTip=20]="DragMoveTip",e[e.HandlerTools=30]="HandlerTools",e[e.DraggingItem=40]="DraggingItem"}(N||(N={})),($=E||(E={})).Auto="AUTO",$.Stretch="STRETCH",$.Custom="CUSTOM",(0,e.createSelector)([e=>e.appConfig.mainSizeMode,e=>e.browserSizeMode,(t,o)=>{var i,n,l,a,r;let s;if(t.browserSizeMode===t.appConfig.mainSizeMode)s=!0;else{let a;(null===(i=o.layouts)||void 0===i?void 0:i[t.browserSizeMode])?a=t.browserSizeMode:(null===(n=o.layouts)||void 0===n?void 0:n[t.appConfig.mainSizeMode])&&(a=t.appConfig.mainSizeMode);const r=null===(l=o.layouts)||void 0===l?void 0:l[a],d=function(t,o,i){var n;let l=t.layouts[o];for(;(null==l?void 0:l.parent)&&[e.LayoutParentType.Screen,e.LayoutParentType.View,e.LayoutParentType.Widget].includes(l.parent.type);){const e=H({layoutId:o},t,i);o=null==e?void 0:e.layoutId,l=t.layouts[o]}switch(null===(n=null==l?void 0:l.parent)||void 0===n?void 0:n.type){case e.LayoutParentType.Dialog:return{type:e.ContainerType.Dialog,id:l.parent.id};case e.LayoutParentType.Page:return{type:e.ContainerType.Page,id:l.parent.id};case e.LayoutParentType.Header:return{type:e.ContainerType.Header,id:"header"};case e.LayoutParentType.Footer:return{type:e.ContainerType.Footer,id:"footer"}}}(t.appConfig,r,a);(null==d?void 0:d.type)===e.ContainerType.Header?s=null!=t.appConfig.header.layout[t.browserSizeMode]:(null==d?void 0:d.type)===e.ContainerType.Footer?s=null!=t.appConfig.footer.layout[t.browserSizeMode]:(null==d?void 0:d.type)===e.ContainerType.Dialog?s=null!=t.appConfig.dialogs[d.id].layout[t.browserSizeMode]:(null==d?void 0:d.type)===e.ContainerType.Page&&(s=null!=t.appConfig.pages[d.id].layout[t.browserSizeMode])}if(s&&(null===(a=o.layouts)||void 0===a?void 0:a[t.browserSizeMode])){const e=o.layouts[t.browserSizeMode];return t.appConfig.layouts[e]}const d=null===(r=o.layouts)||void 0===r?void 0:r[t.appConfig.mainSizeMode];return t.appConfig.layouts[d]}],((e,t,o)=>({mainSizeMode:e,browserSizeMode:t,layout:o}))),(0,e.createSelector)([(e,t)=>{var o,i,n;const{layoutId:l,layoutItemId:a}=t;return null===(n=null===(i=null===(o=e.appConfig.layouts)||void 0===o?void 0:o[l])||void 0===i?void 0:i.content)||void 0===n?void 0:n[a]},(t,o)=>{var i,n,l,a,r,s;const{layoutId:d,layoutItemId:u}=o,c=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[d])||void 0===n?void 0:n.content)||void 0===l?void 0:l[u];if((null==c?void 0:c.type)===e.LayoutItemType.Widget&&c.widgetId){const e=t.appConfig.widgets[c.widgetId];return null!==(s=null===(r=null===(a=null==e?void 0:e.manifest)||void 0===a?void 0:a.properties)||void 0===r?void 0:r.watchViewportVisibility)&&void 0!==s&&s}return!1},e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.selection},e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.animationPreview},e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.hoverPreview},(e,t)=>t.layoutId],((e,t,o,i,n,l)=>{var a;if(!e)return{layoutItem:null,selected:!1};let r=!1;const s=null!==(a=e.isPending)&&void 0!==a&&a;o&&(r=o.layoutId===l&&o.layoutItemId===e.id);const d={selected:r,watchViewportVisibility:t,layoutItem:s?null:e,autoScroll:r?o.autoScroll:void 0};if(r&&(null==i?void 0:i.layoutInfo)){const{layoutId:t,layoutItemId:o}=i.layoutInfo;d.animationPreview=t===l&&o===e.id,d.playMode=d.animationPreview?i.playMode:null,d.previewId=d.animationPreview?i.id:null}else if(r&&(null==n?void 0:n.layoutInfo)){const{layoutId:t,layoutItemId:o}=n.layoutInfo;d.hoverPreview=t===l&&o===e.id,d.previewId=d.hoverPreview?n.id:null}return d})),(0,e.createSelector)([(t,o)=>{var i,n,l;const{layoutId:a,layoutItemId:r}=o,s=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[a])||void 0===n?void 0:n.content)||void 0===l?void 0:l[r];if((null==s?void 0:s.type)===e.LayoutItemType.Widget&&s.widgetId)return t.appConfig.widgets[s.widgetId]},(t,o)=>{var i,n,l,a;const{layoutId:r,layoutItemId:s}=o,d=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[r])||void 0===n?void 0:n.content)||void 0===l?void 0:l[s];if((null==d?void 0:d.type)===e.LayoutItemType.Widget&&!d.widgetId)return null===(a=d.setting)||void 0===a?void 0:a.placeholderStyle},(t,o)=>{var i,n,l;const{layoutId:a,layoutItemId:r}=o,s=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[a])||void 0===n?void 0:n.content)||void 0===l?void 0:l[r];if((null==s?void 0:s.type)===e.LayoutItemType.Widget&&s.widgetId)return t.widgetsRuntimeInfo[s.widgetId]},(t,o)=>{var i,n,l;const{layoutId:a,layoutItemId:r}=o,s=null===(l=null===(n=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[a])||void 0===n?void 0:n.content)||void 0===l?void 0:l[r];if((null==s?void 0:s.type)===e.LayoutItemType.Widget&&!s.widgetId)return t.widgetsState[s.widgetId]},(t,o)=>{var i,n;const{layoutId:l}=o,a=null===(i=t.appConfig.layouts)||void 0===i?void 0:i[l];if((null===(n=a.parent)||void 0===n?void 0:n.type)===e.LayoutParentType.Widget){const e=a.parent.id,o=t.appConfig.widgets[e];return/widgets\/common\/controller\/?/.test(o.uri)}return!1}],((t,o,i,n,l)=>{var a,r,s,d,u,c,p,g,v,h,f,m,y,w,b,I;const x=null===(r=null===(a=null==t?void 0:t.manifest)||void 0===a?void 0:a.properties)||void 0===r?void 0:r.supportInlineEditing;return{hasEmbeddedLayout:(null===(d=null===(s=null==t?void 0:t.manifest)||void 0===s?void 0:s.properties)||void 0===d?void 0:d.hasEmbeddedLayout)&&Object.keys(null!==(u=t.layouts)&&void 0!==u?u:{}).length>0,supportInlineEditing:x,supportRepeat:null===(p=null===(c=null==t?void 0:t.manifest)||void 0===c?void 0:c.properties)||void 0===p?void 0:p.supportRepeat,isClassLoaded:null!==(g=null==i?void 0:i.isClassLoaded)&&void 0!==g&&g,isInlineEditing:x&&(null==i?void 0:i.isInlineEditing),isInController:l,useDragHandler:null!==(f=null===(h=null===(v=null==t?void 0:t.manifest)||void 0===v?void 0:v.properties)||void 0===h?void 0:h.useDragHandler)&&void 0!==f&&f,widgetStyle:null!=t?t.style:o,canCrossLayoutBoundary:null===(y=null===(m=null==t?void 0:t.manifest)||void 0===m?void 0:m.properties)||void 0===y?void 0:y.canCrossLayoutBoundary,hasExtension:(null===(b=null===(w=null==t?void 0:t.manifest)||void 0===w?void 0:w.extensions)||void 0===b?void 0:b.length)>0,widgetJson:t,widgetId:null==t?void 0:t.id,isFunctionalWidget:(null===(I=null==t?void 0:t.manifest)||void 0===I?void 0:I.widgetType)!==e.WidgetType.Layout,widgetState:n}}));var W=function(e,t,o,i){return new(o||(o=Promise))((function(n,l){function a(e){try{s(i.next(e))}catch(e){l(e)}}function r(e){try{s(i.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}s((i=i.apply(e,t||[])).next())}))};function V(t,o){window.jimuConfig.isBuilder?((0,D.getAppConfigAction)(t).exec(),D.builderAppSync.publishChangeSelectionToApp(o)):(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(t,o))}function F(t,o,i){return W(this,void 0,void 0,(function*(){const n=o.layoutInfo;return o.id?yield function(e,t,o){var i;return W(this,void 0,void 0,(function*(){const n=(0,D.getAppConfigAction)(e);let l;const a=P.utils.getCurrentSizeMode();l=t.isFromCurrentSizeMode?a:P.searchUtils.getBrowserSizeModeByLayoutId(e,t.layoutInfo.layoutId);const r=P.searchUtils.findLayoutItem(n.appConfig,t.layoutInfo),s=n.moveLayoutItem(t.layoutInfo,o,l,a);return(null===(i=r.setting)||void 0===i?void 0:i.lockParent)&&n.editLayoutItemProperty(s,"setting.lockParent",!0),yield Promise.resolve({layoutInfo:s,updatedAppConfig:n.appConfig})}))}(t,o,i):n&&n.layoutId&&n.layoutItemId?yield function(e,t,o){return W(this,void 0,void 0,(function*(){const i=(0,D.getAppConfigAction)(e),n=P.utils.getCurrentSizeMode(),l=i.moveLayoutItem(t.layoutInfo,o,n,n),a=P.searchUtils.getWidgetIdThatUseTheLayoutId(e,o);return a&&U(e.widgets[a])&&i.editLayoutItemProperty(l,"setting.lockParent",!0),{layoutInfo:l,updatedAppConfig:i.appConfig}}))}(t,o,i):o.itemType===e.LayoutItemType.Section?yield function(e,t){return W(this,void 0,void 0,(function*(){const o=(0,D.getAppConfigAction)(e),i=o.addNewSectionToLayout(t);return{layoutInfo:{layoutId:t,layoutItemId:i},updatedAppConfig:o.appConfig}}))}(t,i):o.uri||o.itemId?yield function(e,t,o){return W(this,void 0,void 0,(function*(){D.appBuilderSync.publishIsBusyToBuilder(!0);const i=(0,D.getAppConfigAction)(e),n=yield i.addNewWidgetToLayout(o,{uri:t.uri,itemId:t.itemId}),l={layoutId:o,layoutItemId:n},a=P.searchUtils.getWidgetIdThatUseTheLayoutId(e,o);return a&&U(e.widgets[a])&&i.editLayoutItemProperty(l,"setting.lockParent",!0),D.appBuilderSync.publishIsBusyToBuilder(!1),{layoutInfo:l,updatedAppConfig:i.appConfig}}))}(t,o,i):yield function(e,t){return W(this,void 0,void 0,(function*(){const o=(0,D.getAppConfigAction)(e),i=o.addPlaceholderToLayout(t),n={layoutId:t,layoutItemId:i},l=P.searchUtils.getWidgetIdThatUseTheLayoutId(e,t);return l&&U(e.widgets[l])&&o.editLayoutItemProperty(n,"setting.lockParent",!0),{layoutInfo:n,updatedAppConfig:o.appConfig}}))}(t,i)}))}function U(t){var o,i,n,l,a,r,s;const d=null===(o=null==t?void 0:t.manifest)||void 0===o?void 0:o.widgetType,u=null!==(l=null===(n=null===(i=null==t?void 0:t.manifest)||void 0===i?void 0:i.properties)||void 0===n?void 0:n.hasEmbeddedLayout)&&void 0!==l&&l,c=null!==(s=null===(r=null===(a=null==t?void 0:t.manifest)||void 0===a?void 0:a.properties)||void 0===r?void 0:r.lockChildren)&&void 0!==s&&s;return d!==e.WidgetType.Layout&&u&&c}class _ extends e.React.PureComponent{constructor(e){super(e),this.topLeft=this.updateFloatingArea.bind(this,1),this.topCenter=this.updateFloatingArea.bind(this,2),this.topRight=this.updateFloatingArea.bind(this,3),this.middleLeft=this.updateFloatingArea.bind(this,4),this.middleCenter=this.updateFloatingArea.bind(this,5),this.middleRight=this.updateFloatingArea.bind(this,6),this.bottomLeft=this.updateFloatingArea.bind(this,7),this.bottomCenter=this.updateFloatingArea.bind(this,8),this.bottomRight=this.updateFloatingArea.bind(this,9)}updateFloatingArea(t){const{layoutId:o,layoutItem:i}=this.props;!function(t,o,i){W(this,void 0,void 0,(function*(){const n=P.utils.getCurrentPageRootLayoutId();let l=(0,D.getAppConfigAction)();const a=yield F(l.appConfig,{layoutInfo:t},n);l=(0,D.getAppConfigAction)(a.updatedAppConfig),l.editLayoutItemProperty(a.layoutInfo,"bbox",{top:0,left:0,right:0,width:`${o.width}px`,height:`${o.height}px`}).editLayoutItemProperty(a.layoutInfo,"setting.isFloating",!0).editLayoutItemProperty(a.layoutInfo,"setting.lockParent",!0).editLayoutItemProperty(a.layoutInfo,"setting.floatingArea",i).adjustOrderOfItem(a.layoutInfo,null),window.jimuConfig.isBuilder?((0,D.getAppConfigAction)(l.appConfig).exec(),D.builderAppSync.publishChangeSelectionToApp(a.layoutInfo)):(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(l.appConfig,a.layoutInfo))}))}({layoutId:o,layoutItemId:i.id},this.getSizeOfItem(),t)}getSizeOfItem(){const{layoutId:t,layoutItem:o}=this.props;let i;if(window.jimuConfig.isBuilder){const t=document.querySelector(`iframe[name="${e.APP_FRAME_NAME_IN_BUILDER}"]`);i=(null==t?void 0:t.contentDocument)||(null==t?void 0:t.contentWindow.document)}else i=document;const n=i.querySelector(`div.exb-rnd[data-layoutid="${t}"][data-layoutitemid="${o.id}"]`);return n?n.getBoundingClientRect():null}getStyle(){let t;t=window.jimuConfig.isBuilder?(0,y.getTheme)():(0,y.getTheme2)();const o=t.colors.palette.light[500];return e.css`
      background-color: ${t.colors.palette.light[300]};
      position: relative;
      padding: 4px;

      .content {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-row-gap: 0;
        grid-column-gap: 0;
        border: 1px solid ${o};

        & > button {
          cursor: pointer;
          height: 50px;
          width: 50px;
          position: relative;
          border: none;
          background-color: transparent;
          border-radius: 0;

          &:after {
            content: '';
            position: absolute;
            left: 1px;
            top: 1px;
            right: 1px;
            bottom: 1px;
          }

          &:hover {
            &:after {
              outline: 1px solid ${t.colors.palette.primary[700]};
              background: ${t.colors.palette.primary[100]};
            }
          }
        }

        & > button:nth-of-type(3n+1) {
          border-right: 1px solid ${o};
        }
        & > button:nth-of-type(3n) {
          border-left: 1px solid ${o};
        }
        & > button:nth-of-type(1), & > button:nth-of-type(2), & > button:nth-of-type(3) {
          border-bottom: 1px solid ${o};
        }
        & > button:nth-of-type(7), & > button:nth-of-type(8), & > button:nth-of-type(9) {
          border-top: 1px solid ${o};
        }

        .selected:after {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          background-color: ${t.colors.palette.primary[100]};
          border: 1px solid ${t.colors.palette.primary[600]};
        }
      }
    `}render(){const{area:o}=this.props;return(0,e.jsx)("div",{className:"floating-area-chooser d-flex",css:this.getStyle()},(0,e.jsx)("div",{className:"content w-100"},(0,e.jsx)(t.Button,{className:(0,e.classNames)("top-left",{selected:1===o}),onClick:this.topLeft}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("top-center",{selected:2===o}),onClick:this.topCenter}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("top-right",{selected:3===o}),onClick:this.topRight}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("middle-left",{selected:4===o}),onClick:this.middleLeft}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("middle-center",{selected:5===o}),onClick:this.middleCenter}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("middle-right",{selected:6===o}),onClick:this.middleRight}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("bottom-left",{selected:7===o}),onClick:this.bottomLeft}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("bottom-center",{selected:8===o}),onClick:this.bottomCenter}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("bottom-right",{selected:9===o}),onClick:this.bottomRight})))}}_.defaultProps={area:0};var G=u(54357),q=u.n(G),X=u(63059),Y=u.n(X),Z=u(35384),J=u.n(Z),K=u(50970),Q=u.n(K),ee=u(83616),te=u.n(ee),oe=u(47465),ie=u.n(oe),ne=u(41553),le=u.n(ne);function ae(){var t;let o=(0,e.getAppStore)().getState();return window.jimuConfig.isBuilder&&(o=o.appStateInBuilder),null===(t=o.appRuntimeInfo)||void 0===t?void 0:t.appMode}function re(){var t,o,i;let n=(0,e.getAppStore)().getState();return window.jimuConfig.isBuilder&&(n=n.appStateInBuilder),null!==(i=null===(o=null===(t=n.appConfig)||void 0===t?void 0:t.forBuilderAttributes)||void 0===o?void 0:o.lockLayout)&&void 0!==i&&i}function se(){return ae()===e.AppMode.Design}const de={icon:q(),title:e=>e.formatMessage("delete"),visible:t=>ae()===e.AppMode.Design&&(!re()||function(t){var o;let i=(0,e.getAppStore)().getState();if(window.jimuConfig.isBuilder&&(i=i.appStateInBuilder),t.type===e.LayoutItemType.Widget&&t.widgetId){const n=i.appConfig.widgets[t.widgetId];if(n)return(null===(o=n.manifest)||void 0===o?void 0:o.widgetType)!==e.WidgetType.Layout}return!1}(t.layoutItem)),onClick:e=>{const{layoutItem:t,layoutId:o}=e,i={layoutId:o,layoutItemId:t.id};D.appBuilderSync.publishConfirmDeleteToApp(i)}},ue={icon:Y(),title:e=>e.formatMessage("pendingTip"),visible:t=>ae()===e.AppMode.Design&&!re()&&function(e){const{layoutItem:t}=e;return null!=t.widgetId||null!=t.sectionId||null!=t.screenGroupId}(t),onClick:e=>{const{layoutId:t,layoutItem:o}=e;!function(e){const t=(0,D.getAppConfigAction)();t.setLayoutItemToPending(e,!0),V(t.appConfig,null)}({layoutId:t,layoutItemId:o.id})}},ce=(le(),J(),{icon:Q(),title:e=>e.formatMessage("duplicate"),visible:t=>{var o,i,n;if(re()||!se())return!1;const{layoutId:l}=t,a=null===(o=(0,e.getAppStore)().getState().appConfig)||void 0===o?void 0:o.layouts[l];return"ROW"!==(null==a?void 0:a.type)||(null!==(n=null===(i=a.order)||void 0===i?void 0:i.length)&&void 0!==n?n:0)<12},onClick:e=>{const{layoutId:t,layoutItem:o}=e;!function(e){const{layoutId:t}=e,o=(0,D.getAppConfigAction)(),i={layoutId:t,layoutItemId:o.duplicateLayoutItemInSameLayout(e)};V(o.appConfig,i)}({layoutId:t,layoutItemId:o.id})}}),pe={icon:te(),title:e=>e.formatMessage("floating"),visible:t=>{if(re()||!se())return!1;const{layoutItem:o,layoutId:i}=t;return function(t){var o,i,n,l,a;const{layoutId:r,layoutItemId:s}=t,d=(0,D.getAppConfigAction)().appConfig,u=null===(n=null===(i=null===(o=null==d?void 0:d.layouts)||void 0===o?void 0:o[r])||void 0===i?void 0:i.content)||void 0===n?void 0:n[s];if(!u||(null===(l=u.setting)||void 0===l?void 0:l.isFloating))return!1;const c=P.utils.getActivePagePart();if(c!==e.PagePart.Header&&c!==e.PagePart.Footer){const t=P.utils.getCurrentPageRootLayoutId();return(null===(a=d.layouts[t])||void 0===a?void 0:a.type)===e.LayoutType.FlowLayout&&r!==t}return!1}({layoutId:i,layoutItemId:o.id})},settingPanel:_,onClick:()=>{}},ge={icon:ie(),title:e=>e.formatMessage("sinking"),visible:e=>{var t,o;if(re()||!se())return!1;const{layoutItem:i}=e;return null!==(o=null===(t=i.setting)||void 0===t?void 0:t.isFloating)&&void 0!==o&&o},onClick:t=>{const{layoutId:o,layoutItem:i,clientRect:n}=t;!function(t,o){var i;W(this,void 0,void 0,(function*(){const{layoutId:n,layoutItemId:l}=t,a=(0,D.getAppConfigAction)();let r,s,d=-1,u=2;if(window.jimuConfig.isBuilder){const t=document.querySelector(`iframe[name="${e.APP_FRAME_NAME_IN_BUILDER}"]`);s=(null==t?void 0:t.contentDocument)||(null==t?void 0:t.contentWindow.document)}else s=document;if(null==o){const e=s.querySelector(`div.exb-rnd[data-layoutid="${n}"][data-layoutitemid="${l}"]`);o=e?e.getBoundingClientRect():{width:100,height:100}}const c=s.querySelectorAll(`div.flow-layout[data-layoutid="${n}"] > div.trail-container > div.builder-layout-item:not(.floating)`);if((null==c?void 0:c.length)>1)for(let e=0;e<c.length;e++){const t=c[e];if(-1===d&&t.getAttribute("data-layoutitemid")!==l){const i=t.getBoundingClientRect();if(u=Math.round(12*o.width/i.width),P.utils.contains(i,o)){d=e,r=i;break}if(P.utils.intersects(i,o)){d=e+1,r=i;break}}}else{const t=e.utils.findViewportSize(P.utils.getAppConfig(),P.utils.getCurrentSizeMode());r={left:0,top:0,width:t.width,height:t.height},u=Math.round(12*o.width/t.width)}-1===d&&(d=(null===(i=a.appConfig.layouts[n].order)||void 0===i?void 0:i.length)||0),function(t,o,i,n,l,a,r){W(this,void 0,void 0,(function*(){let s=(0,D.getAppConfigAction)(r);const d={name:"row",label:"row",uri:"widgets/layout/row/",icon:null,itemType:e.LayoutItemType.Widget,manifest:{widgetType:e.WidgetType.Layout,properties:{}}},u=yield F(s.appConfig,d,o),{updatedAppConfig:c,layoutInfo:p}=u,g=P.utils.replaceBoundingBox(null,n,i);s=(0,D.getAppConfigAction)(c),s.editLayoutItemProperty(p,"bbox",g).adjustOrderOfItem(p,a);const v=P.searchUtils.findLayoutItem(c,u.layoutInfo),h=c.widgets[v.widgetId],f=Object.keys(h.layouts)[0],m=h.layouts[f],y=P.searchUtils.findLayoutId(m,(0,e.getAppStore)().getState().browserSizeMode,c.mainSizeMode),w=e.i18n.getIntl().formatMessage({id:"block"}),b=e.appConfigUtils.getUniqueLabel(c,"widget",w);s.editWidgetProperty(h.id,"label",b).editLayoutItemProperty(p,"setting.heightMode","fixed").editLayoutItemProperty(p,"bbox.height",n.height+20).editLayoutProperty(y,"parent",{id:h.id,type:e.LayoutParentType.Widget});const I=yield F(s.appConfig,t,y),{layoutInfo:x,updatedAppConfig:C}=I;s=(0,D.getAppConfigAction)(C),s.editLayoutItemProperty(x,"setting.heightMode","fit").editLayoutItemProperty(x,"bbox.left",0).editLayoutItemProperty(x,"bbox.width",l).editLayoutItemProperty(x,"bbox.height",Math.round(Math.min(n.height,i.height))).adjustOrderOfItem(x,0),window.jimuConfig.isBuilder?((0,D.getAppConfigAction)(s.appConfig).exec(),D.builderAppSync.publishChangeSelectionToApp(x)):(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(s.appConfig,x))}))}({layoutInfo:t},n,r||o,o,u,d)}))}({layoutId:o,layoutItemId:i.id},n)}};u(54020);class ve extends e.React.PureComponent{constructor(e){super(e),this.state={activeItem:null},P.utils.autoBindHandlers(this,["onItemClick","onItemUnSelected"])}onItemClick(e){let t=this.state.toggleOn;t=e!==this.state.activeItem||!t,this.setState({activeItem:e,toggleOn:t})}onItemUnSelected(e){e===this.state.activeItem&&this.setState({activeItem:null,toggleOn:!1})}getStyle(){const{theme:t}=this.props;return e.css`
      display: flex;
      pointer-events: all;
      border-radius: 2px;
      box-shadow: 0 2px 8px 1px rgba(0,0,0,0.20);
      height: 100%;
      margin: 5px 0;
      background: ${t.colors.palette.light[300]};

      .toolbar-item, .toolbar-item {
        .jimu-btn:focus, .jimu-btn:focus-visible {
          z-index: 1;
        }
      }

      .${"interactjs-dragging"} &,
      .${"interactjs-resizing"} &,
      .${"exb-h5-dragging"} & {
        display: none;
      }
    `}reOrganizeTools(){const{tools:t}=this.props;if(P.utils.getCurrentSizeMode()===e.BrowserSizeMode.Small&&t.filter((e=>{let t;t=Array.isArray(e)?e[0]:e;const{visible:o,seperator:i=!1}=t,n="function"==typeof o?o(this.props):o;return!i&&(void 0===o||n)})).length>8){const e=t.slice(0,8),o=t.slice(8).map((e=>Object.assign(Object.assign({},e),{label:e.title}))),i=[{icon:R(),caret:!1},...o];return e.push(i),e}return t}render(){const{tools:t,isLockLayout:o}=this.props;if(!t||0===t.length)return null;const i=this.reOrganizeTools(),{activeItem:n,toggleOn:l}=this.state;return(0,e.jsx)(k.Provider,{value:Object.assign(Object.assign({},this.props),{activeItem:n,toggleOn:l,onItemClick:this.onItemClick,onItemUnSelected:this.onItemUnSelected,isLockLayout:o})},(0,e.jsx)("div",{css:this.getStyle(),className:`layout-item-toolbar ${window.jimuConfig.isInBuilder?y.Theme2GlobalStyleClassName:""}`},i.map(((t,o)=>Array.isArray(t)?(0,e.jsx)(B,{uid:`${o}`,key:o,tools:t}):(0,e.jsx)(L,Object.assign({uid:`${o}`,key:o},t))))))}}const he=(0,e.createSelector)((e=>{var t,o,i;return null!==(i=null===(o=null===(t=e.appConfig)||void 0===t?void 0:t.forBuilderAttributes)||void 0===o?void 0:o.lockLayout)&&void 0!==i&&i}),(e=>({isLockLayout:e}))),fe=e.ReactRedux.connect(he)(ve);var me=u(11407),ye=u.n(me),we=u(3273),be=u.n(we),Ie=u(34750),xe=u.n(Ie),Ce=u(39365);function Se(t){let o=(0,e.getAppStore)().getState();return window.jimuConfig.isBuilder&&(o=o.appStateInBuilder),P.searchUtils.getSectionInfo(o,t.sectionId)}function Re(t){var o;const{navInfo:i,views:n,activeView:l}=null!=t?t:{};if(!i)return null==l?void 0:l.id;if(!i.useProgress)return i.currentViewId;const a=(null===(o=i.visibleViews)||void 0===o?void 0:o.length)>0?i.visibleViews:n,{currentIndex:r}=(0,e.getIndexFromProgress)(i.progress,a.length);return a[r]}const ke={icon:u.n(Ce)(),title:e=>e.formatMessage("duplicateView"),visible:()=>ae()===e.AppMode.Design&&!re(),onClick:t=>{const{layoutItem:o}=t;let i=Re(Se(o));i||(i=Se(o).views[0]);const n=(0,D.getAppConfigAction)(),l=n.duplicateView(i,o.sectionId,!0);n.exec(),e.jimuHistory.changeView(o.sectionId,l.id)}},Pe={icon:p(),title:e=>e.formatMessage("deleteView"),visible:t=>{if(ae()!==e.AppMode.Design||re())return!1;const{layoutItem:o}=t,i=Se(o);if(!i)return!1;const{views:n}=i;return n&&n.length>1},onClick:t=>{const{layoutItem:o}=t,i=Se(o),{views:n}=i,l=Re(i);if(n.length>1){const i=n.indexOf(l);let a;a=i>0?n[i-1]:n[1],(0,D.getAppConfigAction)().removeView(l,o.sectionId).exec(),e.jimuHistory.changeView(t.layoutItem.sectionId,a)}}},Ae=[{icon:ye(),autoFlipIcon:!0,size:10,title:e=>e.formatMessage("previousView"),onClick:t=>{const{layoutItem:o}=t,i=Se(o),{views:n}=i,l=Re(i),a=n.indexOf(l);a>0&&e.jimuHistory.changeView(o.sectionId,n[a-1])},disabled:e=>{const{layoutItem:t}=e,o=Se(t);if(!o)return!0;const{views:i}=o,n=Re(o);return i.indexOf(n)<=0}},{label:e=>{const{layoutItem:t}=e,o=Se(t);if(!o)return"";const{views:i}=o,n=Re(o);return`${Math.max(0,i.indexOf(n))+1} / ${i.length}`}},{icon:be(),autoFlipIcon:!0,size:10,title:e=>e.formatMessage("nextView"),onClick:t=>{const{layoutItem:o}=t,i=Se(o),{views:n}=i,l=Re(i),a=n.indexOf(l);a>=0&&a<n.length-1&&e.jimuHistory.changeView(o.sectionId,n[a+1])},disabled:e=>{const{layoutItem:t}=e,o=Se(t);if(!o)return!0;const{views:i}=o,n=Re(o),l=i.indexOf(n);return l<0||l>=i.length-1}},{icon:xe(),title:e=>e.formatMessage("addView"),visible:()=>ae()===e.AppMode.Design&&!re(),onClick:t=>{const{layoutItem:o}=t,i=(0,D.getAppConfigAction)(),n=i.addView(o.sectionId);i.exec(),e.jimuHistory.changeView(o.sectionId,n)}},ke,Pe,{seperator:!0}],je=[ce,pe,ge,ue,de],Me=[].concat(Ae,je);let Le=0;function ze(o){e.ReactRedux.useSelector((t=>t.extensionsInfo[e.extensionSpec.ExtensionPoints.ContextTool]));const{layoutId:i,layoutItem:n,refElement:l,modifiers:a,formatMessage:r,builderTheme:s,toolItems:d=[],showDefaultTools:u=!0}=o;if(!l)return null;const c=n.type===e.LayoutItemType.Section;let p=function({layoutId:t,layoutItem:o,refElement:i}){const{widgetId:n}=o;if(!n)return[];const l=e.ExtensionManager.getInstance().getExtensions(e.extensionSpec.ExtensionPoints.ContextTool),a=i.getBoundingClientRect();return l.filter((e=>e.widgetId===n)).map((e=>({widgetId:n,icon:e.getIcon(),title:e.getTitle.bind(e),onClick:e.onClick.bind(e),checked:e.checked&&e.checked.bind(e),disabled:e.disabled?"function"==typeof e.disabled?e.disabled.bind(e):e.disabled:null,visible:e.visible?"function"==typeof e.visible?e.visible.bind(e):e.visible:null,settingPanel:e.getSettingPanel({layoutId:t,layoutItem:o,clientRect:a}),index:e.index,extName:e.name}))).sort(((e,t)=>e.index-t.index))}(o);const g=c?Me:je,v=u?[...d,...g]:d;return p=p.length>0?[].concat(v,{seperator:!0},p):v,0===p.length?null:(0,e.jsx)(t._Popper,{placement:"top-start",reference:l,open:!0,modifiers:a,version:Le++,trapFocus:!1,autoFocus:!1,css:e.css`
        background: transparent;
        box-shadow: none;
      `},(0,e.jsx)("div",null,(0,e.jsx)(fe,{layoutId:i,layoutItem:n,theme:s,parentRef:l,tools:p,formatMessage:r})))}const Te=e.css`
  max-width: 100vw !important;
  /* hide rnd-resize bar for the outermost layout item */
  .controller-configuration-container > * > * > .builder-layout-item > .select-wrapper > .action-area {
      > .rnd-resize-top,
      > .rnd-resize-right,
      > .rnd-resize-bottom,
      > .rnd-resize-left {
        display: none;
      }
    }

    .controller-configuration-container .builder-layout-item > .select-wrapper > .lock-layout-tip {
      display: none;
    }

  .selectable {
    > div {
      cursor: default;
    }
  }

  .widget-container {
    height: 100%;
    overflow: auto;
  }
`,Be={width:150,height:150},Oe={width:300,height:300},Ne=o=>{const{reference:i,placement:l,disableResize:a=!1,widgetId:r,controllerId:s,onClose:d,onSizeChange:u,size:c,version:p}=o,g=e.ReactRedux.useSelector((e=>{var t,o;return null===(o=null===(t=e.appConfig.widgets)||void 0===t?void 0:t[r])||void 0===o?void 0:o.label})),[v,h]=e.React.useState(!!r);e.hooks.useUpdateEffect((()=>{h(!1),setTimeout((()=>{h(!!r)}),0)}),[r]);const[f,m]=e.React.useState(""),[w,b]=e.React.useState(""),[I,x]=e.React.useState(null);e.React.useEffect((()=>{var t,o,i,n,l,a,d,u,c;const p=(0,e.getAppStore)().getState(),g=p.appConfig.widgets[r],v=p.browserSizeMode;let h=null!==(o=null===(t=null==g?void 0:g.parent)||void 0===t?void 0:t[v])&&void 0!==o?o:[];0===h.length&&(h=null!==(n=null===(i=null==g?void 0:g.parent)||void 0===i?void 0:i[p.appConfig.mainSizeMode])&&void 0!==n?n:[]);const f=p.appConfig.layouts,y=h.find((e=>{const t=e.layoutId;return f[t].parent.id===s})),w=null!==(l=null==y?void 0:y.layoutId)&&void 0!==l?l:"";m(w);const I=null!==(a=null==y?void 0:y.layoutItemId)&&void 0!==a?a:"";b(I);const C=null!==(u=null===(d=f[w])||void 0===d?void 0:d.content)&&void 0!==u?u:{};x(null!==(c=C[I])&&void 0!==c?c:null)}),[s,r]);const[S,R]=e.React.useState(null),k=e.React.useCallback((e=>{"hidden"!==e.style.visibility&&"none"!==e.style.display?S!==e&&R(e):R(null)}),[S]),P=[{name:"preventOverflow",enabled:!0,options:{boundary:"viewport",altAxis:!0}},{name:"flip",enabled:!0,options:{boundary:"viewport",fallbackPlacements:(0,t.getFallbackPlacementsModifier)(["top-start","bottom-start"],!0).options.fallbackPlacements}}],A=(0,y.getTheme2)(),j=e.hooks.useTranslation(),M=e.ReactRedux.useSelector((t=>t.appRuntimeInfo.appMode===e.AppMode.Design)),L=e.ReactRedux.useSelector((e=>{var t,o,i;const n=e.appConfig.widgets[r];return null!==(i=null===(o=null===(t=null==n?void 0:n.manifest)||void 0===t?void 0:t.properties)||void 0===o?void 0:o.supportInlineEditing)&&void 0!==i&&i})),z=e.ReactRedux.useSelector((e=>{const t=e.widgetsRuntimeInfo[r];return L&&(null==t?void 0:t.isInlineEditing)})),T=e.ReactRedux.useSelector((t=>{var o;const i=t.appConfig.widgets[r];return(null===(o=null==i?void 0:i.manifest)||void 0===o?void 0:o.widgetType)!==e.WidgetType.Layout})),B=e.ReactRedux.useSelector((e=>{var t,o,i;const n=e.appConfig.widgets[r];return(null===(o=null===(t=null==n?void 0:n.manifest)||void 0===t?void 0:t.properties)||void 0===o?void 0:o.hasEmbeddedLayout)&&Object.keys(null!==(i=n.layouts)&&void 0!==i?i:{}).length>0})),O=M&&!z&&T&&!B,N=e.React.useCallback((t=>{t.stopPropagation(),L&&(0,e.getAppStore)().dispatch(e.appActions.setWidgetIsInlineEditingState(r,!0))}),[r,L]);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.Popper,{modifiers:n,floating:!0,open:v,headerTitle:g,onHeaderClose:d,showHeaderCollapse:!0,minSize:Be,onResizeStop:e=>{u(r,e)},dragBounds:"body",defaultSize:c||Oe,css:Te,version:p,className:"flex-grow-1",reference:i,disableResize:a,toggle:e=>{if("Escape"===(null==e?void 0:e.key)){null==d||d();const e=null==i?void 0:i.querySelector("button");null==e||e.focus()}},placement:l,popperNodeRef:k,onClick:e=>{e.stopPropagation()},onDoubleClick:N},(0,e.jsx)("div",{className:"widget-container controller-configuration-container d-flex"},(0,e.jsx)(C,{widgetId:r,layoutId:f,layoutItemId:w,showMask:O}),f&&I&&(0,e.jsx)(ze,{layoutId:f,layoutItem:I,refElement:S,modifiers:P,builderTheme:A,formatMessage:j,showDefaultTools:!1}))))},Ee=(t,o)=>{const i=e.ReactRedux.useSelector((e=>e.widgetsRuntimeInfo)),n=$e(t,o),l=We(n);return e.React.useMemo((()=>{const t={};return l.forEach((o=>{var n;const l=null!==(n=null==i?void 0:i[o])&&void 0!==n?n:{isClassLoaded:!1};t[o]=(0,e.Immutable)(l)})),(0,e.Immutable)(t)}),[l,i])},$e=(t,o)=>e.ReactRedux.useSelector((e=>{var i,n,l,a;const r=null===(l=null===(n=null===(i=e.appConfig.widgets)||void 0===i?void 0:i[t])||void 0===n?void 0:n.layouts)||void 0===l?void 0:l[o],s=e.browserSizeMode,d=e.appConfig.mainSizeMode,u=P.searchUtils.findLayoutId(r,s,d);return null===(a=e.appConfig.layouts)||void 0===a?void 0:a[u]})),De=(t,o)=>{var i,n,l,a;const r=(0,e.getAppStore)().getState().appConfig,s=(0,e.getAppStore)().getState().browserSizeMode,d=null===(l=null===(n=null===(i=r.widgets)||void 0===i?void 0:i[t])||void 0===n?void 0:n.layouts)||void 0===l?void 0:l[o],u=P.searchUtils.findLayoutId(d,s,r.mainSizeMode);return null===(a=r.layouts)||void 0===a?void 0:a[u]},He=e=>{var t,o,i;let n=(null!==(i=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==i?i:[]).map((t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]}));return n=n.filter((e=>e&&e.id&&e.widgetId&&!e.isPending)),n.map((e=>e.id))},We=e=>He(e).map((t=>{var o,i;return null===(i=null===(o=e.content)||void 0===o?void 0:o[t])||void 0===i?void 0:i.widgetId})),Ve=t=>[e.WidgetState.Opened,e.WidgetState.Active].includes(t.state);var Fe=u(77756),Ue=u(77282);const _e=t=>{var o;const i=null==t?void 0:t.itemType,n=null===(o=null==t?void 0:t.manifest)||void 0===o?void 0:o.name;return i!==e.LayoutItemType.Section&&!["controller"].includes(n)&&!P.utils.isWidgetPlaceholder(P.utils.getAppConfig(),t)},Ge=(t,o,i)=>{const n={layoutId:t.id};let l=(0,D.getAppConfigAction)();(0,Ue.addItemToLayout)(l.appConfig,o,t.id).then((t=>{l=(0,D.getAppConfigAction)(t.updatedAppConfig),l.adjustOrderOfItem(t.layoutInfo,i||0),l.editLayoutItemProperty(t.layoutInfo,"bbox",{}),(0,e.getAppStore)().dispatch(e.appActions.layoutChanged(l.appConfig,n))}))};const qe=e.React.forwardRef(((t,o)=>{const{widgetId:i,layout:n,layouts:l,vertical:a,childClass:r,placeholder:s,className:d}=t,u=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o}(t,["widgetId","layout","layouts","vertical","childClass","placeholder","className"]),{color:c,size:[p,g]}=s,v=e.React.useRef(null),h=e.React.useRef(null),f=e.React.useRef(null),m=e.React.useRef(null),y=e.React.useRef(null),[w,b]=e.React.useState(!1),I=e.hooks.useForkRef(v,o),x=e.css`
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    bottom: 0;
    top: 0;
    right: 0;
    background: transparent;
    z-index: ${w?1:0};
    > .drop-area {
      width: 100%;
      height: 100%;
    }
    > .overlay {
      position: absolute;
      left: 0;
      bottom: 0;
      top: 0;
      right: 0;
      background: transparent;
      z-index: -1;
      &.hide {
        display: none;
      }
    }
  `;return e.React.useEffect((()=>{h.current=new Ue.CanvasPane(y.current)}),[]),(0,e.jsx)("div",Object.assign({className:(0,e.classNames)("drop-zone",d),ref:I},u,{css:x}),(0,e.jsx)(Ue.DropArea,{style:x,className:"drop-area",layouts:l,highlightDragover:!0,onDragOver:(t,o,i,n,l,r)=>{let s=n;const d=m.current,u=v.current.offsetHeight,y=v.current.offsetWidth;if(d&&d.length)if(a){const{insertY:e,refId:t}=((e,t,o)=>{let i,n,l=!1;if(t.some(((e,a)=>{if(e.top+e.height/2>o){if(0===a)i=e.top;else{const o=t[a-1];i=(e.top+o.top+o.height)/2}l=!0,n=e.id}return l})),!l){const e=t[t.length-1];i=e.top+e.height}return{insertY:i,refId:n}})(0,d,r);f.current=t,s={top:e-g/2+v.current.scrollTop,width:p,left:(y-p)/2+v.current.scrollLeft,height:g}}else{const{insertX:e,refId:t}=((e,t,o)=>{let i,n,l=!1;if(t.some(((e,a)=>{if(e.left+e.width/2>o){if(0===a)i=e.left;else{const o=t[a-1];i=(e.left+o.left+o.width)/2}l=!0,n=e.id}return l})),!l){const e=t[t.length-1];i=e.left+e.width}return{insertX:i,refId:n}})(0,d,l);f.current=t,s={left:e-g/2+v.current.scrollLeft,width:g,top:(u-p)/2+v.current.scrollTop,height:p}}else s=a?{top:i.height/2-g/2,width:p,left:(y-p)/2+v.current.scrollLeft,height:g}:{left:i.width/2-g/2,width:g,top:(u-p)/2+v.current.scrollTop,height:p};h.current.clear(),h.current.setColor(e.polished.rgba(c,1)),h.current.drawRect(s)},onDrop:(e,t,o)=>{h.current.clear();let i=0;f.current?i=n.order&&n.order.indexOf(f.current)||0:n.order&&(i=n.order.length),Ge(n,e,i),f.current=null,m.current=[]},onToggleDragoverEffect:e=>{e&&(f.current=null,(()=>{m.current=[];const e=v.current.getBoundingClientRect(),t=v.current.parentNode.querySelectorAll(`.${r}`);t&&t.length&&t.forEach((t=>{const o=t.getAttribute("data-layoutitemid");if(n.order&&n.order.includes(o)){const i=P.utils.relativeClientRect(t.getBoundingClientRect(),e);i.id=o,m.current.push(i)}})),a?m.current.sort(((e,t)=>e.top-t.top)):m.current.sort(((e,t)=>e.left-t.left))})(),h.current.setSize(v.current.clientWidth,v.current.clientHeight)),b(e)}}),(0,e.jsx)("canvas",{className:(0,e.classNames)("overlay",{hide:!w}),ref:y}))})),Xe=(0,Ue.withRnd)(!1)((o=>{var i,n;const{markerEnabled:l,onMarkerClick:a,widgetid:r,showLabel:d,showIndicator:u,showTooltip:c,labelGrowth:g,avatar:v,onClick:h,active:f,editDraggable:m,className:y}=o,w=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets)||void 0===t?void 0:t[r]}));return w?e.React.createElement(s,{"data-widgetid":r,widgetid:r,className:`widget-avatar-card ${y}`,showLabel:d,showIndicator:u,showTooltip:c,labelGrowth:g,avatar:v,label:w.label,icon:w.icon,autoFlip:null===(n=null===(i=null==w?void 0:w.manifest)||void 0===i?void 0:i.properties)||void 0===n?void 0:n.flipIcon,marker:l?p():"",active:f,editDraggable:m,onMarkerClick:a,onClick:h}):e.React.createElement(t.Loading,null)})),Ye=t=>{const{className:o,draggable:i,layoutId:n,layoutItem:l,onClick:a,label:r,showLabel:s,showIndicator:d,showTooltip:u,labelGrowth:c,markerEnabled:p,avatar:g,active:v,removeWidget:h}=t;return e.React.createElement(Xe,{className:(0,e.classNames)(o,"layout-item","align-items-center"),layoutId:n,layoutItem:l,widgetid:l.widgetId,layoutItemId:l.id,label:r,markerEnabled:p,showLabel:s,showIndicator:d,showTooltip:u,labelGrowth:c,avatar:g,active:v,editDraggable:i,useDragHandler:!0,onClick:a,onMarkerClick:()=>{h(l.widgetId)}})};const Ze=e.React.forwardRef(((t,i)=>{const{widgetId:n,draggable:l,itemStyle:r,vertical:s,className:d,space:u,dropZoneRef:c,onItemClick:p,onClick:g,scrollRef:v,markerEnabled:f=!0,autoSize:m,placeholder:w,afterRemoveWidget:b}=t,I=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o}(t,["widgetId","draggable","itemStyle","vertical","className","space","dropZoneRef","onItemClick","onClick","scrollRef","markerEnabled","autoSize","placeholder","afterRemoveWidget"]),x=e.ReactRedux.useSelector((e=>{var t,i,l;return null===(l=null===(i=null===(t=e.appConfig.widgets)||void 0===t?void 0:t[n])||void 0===i?void 0:i.layouts)||void 0===l?void 0:l[o]})),C=$e(n,o),S=He(C),R=(0,y.getBuilderThemeVariables)(),k=Ee(n,o),A=Object.keys(k).filter((e=>Ve(k[e]))),j=((e,t)=>{const o=null==e?void 0:e.showLabel,i=null==e?void 0:e.labelGrowth,n=null==e?void 0:e.avatar.size,l=null==e?void 0:e.avatar.shape;return a(n,o,l)+t+i})(r,u),M={color:null==R?void 0:R.colors.palette.primary[700],size:[j,5]};return e.React.createElement(P.LayoutContext.Provider,{value:{isItemAccepted:_e}},e.React.createElement("div",{ref:i,className:(0,e.classNames)(d,"layout controller-layout w-100 h-100 d-flex align-items-center justify-content-center"),"data-layoutid":C.id,onClick:g},e.React.createElement(qe,{widgetId:n,vertical:s,layout:C,childClass:`layout-${C.id}-item`,placeholder:M,layouts:x}),w||e.React.createElement(h,Object.assign({},I,{autoSize:m,scrollRef:v,className:"layout-item-list",vertical:s,itemLength:j,space:u,autoHideArrow:!0,lists:S,autoScrollEnd:!0,createItem:(t,o)=>{const i=C.content[t],n=i&&i.widgetId||"",a=A.includes(n);return e.React.createElement(Ye,Object.assign({},r,{key:t,className:(0,e.classNames)(`layout-${null==C?void 0:C.id}-item layout-item`,o),widgetid:n,layoutId:C.id,layoutItemId:t,draggable:l,markerEnabled:f,layoutItem:i,active:a,removeWidget:e=>{var o;o={layoutId:C.id,layoutItemId:t},D.appBuilderSync.publishConfirmDeleteToApp(o),b(e)},onClick:p}))}}))))}));const Je=e.React.forwardRef(((t,o)=>{var i;const{showPlaceholder:n,itemStyle:l,space:a,vertical:r}=t,s=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(o[i[n]]=e[i[n]])}return o}(t,["showPlaceholder","itemStyle","space","vertical"]),d=r?a:l.labelGrowth;return e.React.createElement(Ze,Object.assign({className:"w-100 h-100",ref:o,itemStyle:l,space:a,vertical:r,placeholder:n?e.React.createElement(x,{size:null===(i=l.avatar)||void 0===i?void 0:i.size,space:d,vertical:r}):void 0},s))})),Ke=e.css`
  width: 300px;
  height: 300px;
  overflow-y: auto;
`,Qe={Builder:t=>{var i,n,l,a,r,s,d;const{id:u,config:c,version:p,autoSize:g}=t,v=e.hooks.useCheckSmallBrowserSizeMode(),h=null!==(n=null===(i=null==c?void 0:c.behavior)||void 0===i?void 0:i.arrangement)&&void 0!==n?n:"floating",f=null===(l=null==c?void 0:c.behavior)||void 0===l?void 0:l.vertical,m=null===(a=c.behavior)||void 0===a?void 0:a.size,y=f?"right-start":"bottom",{viewOnly:w}=e.React.useContext(P.PageContext),b=e.React.useRef(null),I=e.ReactRedux.useSelector((e=>e.widgetsState[u])),x=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appRuntimeInfo)||void 0===t?void 0:t.currentDialogId})),C=null==I?void 0:I.showWidgetsPanel,S=e.ReactRedux.useSelector((e=>e.browserSizeMode)),R=e.React.useRef(),k=Ee(u,o),A=!Object.keys(null!=k?k:{}).length,j=e.ReactRedux.useSelector((e=>e.appRuntimeInfo.selection)),[M,L]=e.React.useState(""),[z,T]=e.React.useState(""),[B,O]=e.React.useState("");e.React.useEffect((()=>{var t,o,i;if(j){const n=(0,e.getAppStore)().getState(),l=n.appConfig,a=Object.keys(k),r=n.browserSizeMode,s=n.appConfig.mainSizeMode;let d=P.searchUtils.findLayoutItem(l,j),u=j.asMutable();for(;d&&!a.includes(null==d?void 0:d.widgetId);)u=P.searchUtils.findParentLayoutInfo(u,l,r)||P.searchUtils.findParentLayoutInfo(u,l,s),d=P.searchUtils.findLayoutItem(l,u);L(null!==(t=null==d?void 0:d.widgetId)&&void 0!==t?t:""),T(null!==(o=null==u?void 0:u.layoutId)&&void 0!==o?o:""),O(null!==(i=null==u?void 0:u.layoutItemId)&&void 0!==i?i:"")}else L(""),T(""),O("")}),[j,k]),e.React.useEffect((()=>{const t=Object.keys(k).filter((e=>Ve(k[e])));(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(t)),M&&(0,e.getAppStore)().dispatch(e.appActions.openWidget(M,u))}),[u,M]);const N=null===(r=b.current)||void 0===r?void 0:r.querySelector(`div.layout-item[data-layoutid="${z}"][data-layoutitemid="${B}"]`),E=null==m?void 0:m[M],$="floating"===h||v;e.React.useEffect((()=>{S===e.BrowserSizeMode.Small&&void 0!==C&&D.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!1,isItemAccepted:_e,onSelect:U,keepPanel:!0,active:C})}),[C]);const H=e.React.useCallback(((t,o,i)=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(u,"hideArrow",t)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(u,"disablePrevious",o)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(u,"disableNext",i))}),[u]);e.React.useEffect((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(u,"onArrowClick",R.current))}),[u]);const W=e.React.useCallback((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(u,"showWidgetsPanel",!1))}),[u]);e.React.useEffect((()=>{x&&W()}),[W,x]);const V=e=>{(0,D.getAppConfigAction)().editWidgetConfig(u,e).exec()},F=e.React.useRef([0,0]),U=e=>{var t,i;const n=De(u,o),l=null!==(i=null===(t=n.order)||void 0===t?void 0:t.length)&&void 0!==i?i:0;Ge(n,e,l)};return(0,e.jsx)("div",{className:"controller-builder w-100 h-100",ref:b,onClick:e=>{const t=e.target,o=b.current;t&&o&&o.contains(t)&&W()}},M&&$&&(0,e.jsx)(Ne,{reference:N,version:p,disableResize:v,widgetId:M,controllerId:u,size:E,onClose:()=>{var t,o;const i=(0,e.getAppStore)().getState(),n=i.appConfig,l=i.browserSizeMode,a=n.widgets[u].parent;let r=null!==(t=a[l])&&void 0!==t?t:[];0===r.length&&(r=null!==(o=a[n.mainSizeMode])&&void 0!==o?o:[]),r.length>0?(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(r[0])):(0,e.getAppStore)().dispatch(e.appActions.selectionChanged(null))},onSizeChange:(t,o)=>{if(!t)return;let i=(null==c?void 0:c.behavior.size)||(0,e.Immutable)({});i=i.set(t,o),V(c.setIn(["behavior","size"],i))},placement:y}),(0,e.jsx)(Je,{autoSize:g,scrollRef:R,showPlaceholder:A,onScrollStatusChange:H,vertical:null===(s=null==c?void 0:c.behavior)||void 0===s?void 0:s.vertical,widgetId:u,onItemClick:t=>{var i;if(w)return;const n=null===(i=t.currentTarget.dataset)||void 0===i?void 0:i.widgetid,l=F.current[0]!==t.clientX||F.current[1]!==t.clientY;if(n&&!l){t.stopPropagation();const i=De(u,o),l=Object.keys(i.content).find((e=>i.content[e].widgetId===n));(0,e.getAppStore)().dispatch(e.appActions.selectionChanged({layoutId:i.id,layoutItemId:l}))}},onMouseDown:e=>{F.current=[e.clientX,e.clientY]},itemStyle:c.appearance.card,draggable:!0,markerEnabled:!w,space:null===(d=null==c?void 0:c.appearance)||void 0===d?void 0:d.space,afterRemoveWidget:e=>{c.behavior.openStarts.includes(e)&&V(c.setIn(["behavior","openStarts"],c.behavior.openStarts.filter((t=>t!==e))))}}),C&&S!==e.BrowserSizeMode.Small&&(0,e.jsx)(Fe.WidgetListPopper,{css:Ke,placement:"right-start",referenceElement:b.current,isAccepted:_e,onSelect:U,onClose:e=>{(e=>{var t,o;if(!e)return!1;if("controller-add-widget"===(null===(t=e.dataset)||void 0===t?void 0:t.extname))return!0;const i=e.parentElement;return"controller-add-widget"===(null===(o=null==i?void 0:i.dataset)||void 0===o?void 0:o.extname)})(null==e?void 0:e.target)||W()}}))}}})(),c})())}}}));